{"openapi":"3.0.0","paths":{"/":{"get":{"operationId":"AppController_getHello","parameters":[],"responses":{"200":{"description":"Application info retrieved successfully"}},"summary":"Get application info","tags":["app"]}},"/health":{"get":{"operationId":"AppController_healthCheck","parameters":[],"responses":{"200":{"description":"Application is healthy"},"503":{"description":"Application is unhealthy"}},"summary":"Health check endpoint","tags":["app"]}},"/users":{"post":{"operationId":"UsersController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateUserDto"}}}},"responses":{"201":{"description":"User created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponseDto"}}}},"409":{"description":"Username or email already exists"}},"summary":"Create a new user","tags":["users"]},"get":{"operationId":"UsersController_findAll","parameters":[],"responses":{"200":{"description":"Users retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserResponseDto"}}}}}},"security":[{"JWT-auth":[]}],"summary":"Get all users","tags":["users"],"x-permission":{"permission":"USER_READ","minLevel":1},"description":"Requires permission: USER_READ (level >= 1)"}},"/users/{id}":{"get":{"operationId":"UsersController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"User retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponseDto"}}}},"404":{"description":"User not found"}},"security":[{"JWT-auth":[]}],"summary":"Get user by ID","tags":["users"],"x-permission":{"permission":"USER_READ","minLevel":1},"description":"Requires permission: USER_READ (level >= 1)"},"patch":{"operationId":"UsersController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateUserDto"}}}},"responses":{"200":{"description":"User updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponseDto"}}}},"404":{"description":"User not found"}},"security":[{"JWT-auth":[]}],"summary":"Update user","tags":["users"],"x-permission":{"permission":"USER_UPDATE","minLevel":1},"description":"Requires permission: USER_UPDATE (level >= 1)"},"delete":{"operationId":"UsersController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"User deleted successfully"},"404":{"description":"User not found"}},"security":[{"JWT-auth":[]}],"summary":"Delete user","tags":["users"],"x-permission":{"permission":"USER_DELETE","minLevel":1},"description":"Requires permission: USER_DELETE (level >= 1)"}},"/auth/register":{"post":{"operationId":"AuthController_register","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateUserDto"}}}},"responses":{"201":{"description":"User registered successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseDto"}}}},"409":{"description":"Username or email already exists"}},"summary":"Register a new user","tags":["auth"]}},"/auth/login":{"post":{"operationId":"AuthController_login","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginUserDto"}}}},"responses":{"201":{"description":"Login successful","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseDto"}}}},"401":{"description":"Invalid credentials"}},"summary":"Login user","tags":["auth"]}},"/auth/profile":{"get":{"operationId":"AuthController_getProfile","parameters":[],"responses":{"200":{"description":"Profile retrieved successfully"},"401":{"description":"Unauthorized"}},"security":[{"JWT-auth":[]}],"summary":"Get user profile","tags":["auth"]}},"/auth/protected":{"get":{"operationId":"AuthController_protectedRoute","parameters":[],"responses":{"200":{"description":"Access granted"},"401":{"description":"Unauthorized"}},"security":[{"JWT-auth":[]}],"summary":"Protected route example","tags":["auth"]}},"/books":{"post":{"operationId":"BooksController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateBookDto"}}}},"responses":{"201":{"description":"Book created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BookResponseDto"}}}},"401":{"description":"Unauthorized"},"409":{"description":"Book with this hash already exists"}},"security":[{"JWT-auth":[]}],"summary":"Create a new book","tags":["books"],"x-permission":{"permission":"BOOK_CREATE","minLevel":1},"description":"Requires permission: BOOK_CREATE (level >= 1)"},"get":{"operationId":"BooksController_findAll","parameters":[{"name":"tags","required":false,"in":"query","description":"Filter by tag keys (comma-separated)","schema":{"example":"author,genre","type":"string"}}],"responses":{"200":{"description":"Books retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BookResponseDto"}}}}}},"summary":"Get all books","tags":["books"]}},"/books/{id}":{"get":{"operationId":"BooksController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Book retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BookResponseDto"}}}},"404":{"description":"Book not found"}},"summary":"Get book by ID","tags":["books"]},"patch":{"operationId":"BooksController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateBookDto"}}}},"responses":{"200":{"description":"Book updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BookResponseDto"}}}},"401":{"description":"Unauthorized"},"404":{"description":"Book not found"},"409":{"description":"Book with this hash already exists"}},"security":[{"JWT-auth":[]}],"summary":"Update book","tags":["books"],"x-permission":{"permission":"BOOK_UPDATE","minLevel":1},"description":"Requires permission: BOOK_UPDATE (level >= 1)"},"delete":{"operationId":"BooksController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Book deleted successfully"},"401":{"description":"Unauthorized"},"404":{"description":"Book not found"}},"security":[{"JWT-auth":[]}],"summary":"Delete book","tags":["books"],"x-permission":{"permission":"BOOK_DELETE","minLevel":1},"description":"Requires permission: BOOK_DELETE (level >= 1)"}},"/books/hash/{hash}":{"get":{"operationId":"BooksController_findByHash","parameters":[{"name":"hash","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Book retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BookResponseDto"}}}},"404":{"description":"Book not found"}},"summary":"Get book by hash","tags":["books"]}},"/books/search":{"post":{"operationId":"BooksController_searchByTags","parameters":[],"requestBody":{"required":true,"description":"Provide one of the supported search patterns. If multiple patterns are supplied, priority order applies: tagKeys > (tagKey+tagValue) > tagFilters > tagId > tagIds. When none is provided, all books are returned.","content":{"application/json":{"schema":{"oneOf":[{"title":"Tag keys list","example":{"tagKeys":"author,genre"}},{"title":"Single key-value","example":{"tagKey":"author","tagValue":"John Doe"}},{"title":"Multiple key-value filters (OR logic)","example":{"tagFilters":[{"key":"author","value":"John Doe"},{"key":"genre","value":"Fiction"}]}},{"title":"Single tag ID","example":{"tagId":12}},{"title":"Multiple tag IDs (AND logic)","example":{"tagIds":"12,34,56"}}]},"examples":{"byTagKeys":{"summary":"Tag keys only","value":{"tagKeys":"author,genre"}},"bySingleKeyValue":{"summary":"Single key-value pair","value":{"tagKey":"author","tagValue":"Isaac Asimov"}},"byMultipleKeyValues":{"summary":"Multiple key-value OR","value":{"tagFilters":[{"key":"author","value":"Isaac Asimov"},{"key":"genre","value":"Science Fiction"}]}},"bySingleTagId":{"summary":"Single tag ID","value":{"tagId":5}},"byMultipleTagIds":{"summary":"Multiple tag IDs AND","value":{"tagIds":"5,8,11"}}}}}},"responses":{"201":{"description":"Books found successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BookResponseDto"}}}}},"400":{"description":"Invalid search parameters"}},"summary":"Search books by tags","tags":["books"]}},"/books/tags/{key}/{value}":{"get":{"operationId":"BooksController_findByTagKeyValue","parameters":[{"name":"key","required":true,"in":"path","schema":{"type":"string"}},{"name":"value","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Books retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BookResponseDto"}}}}}},"summary":"Get books by specific tag key-value pair","tags":["books"]}},"/books/tag-id/{id}":{"get":{"operationId":"BooksController_findByTagId","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Books retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BookResponseDto"}}}}},"400":{"description":"Invalid tag ID"}},"summary":"Get books by tag ID","tags":["books"]}},"/books/tag-ids/{ids}":{"get":{"operationId":"BooksController_findByTagIds","parameters":[{"name":"ids","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Books retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BookResponseDto"}}}}},"400":{"description":"Invalid tag IDs"}},"summary":"Get books by multiple tag IDs (comma-separated)","tags":["books"]}},"/books/recommend/{id}":{"get":{"operationId":"BooksController_recommend","parameters":[{"name":"id","required":true,"in":"query","description":"Base book ID used as similarity seed","schema":{"example":42,"type":"string"}},{"name":"limit","required":false,"in":"query","description":"Max number of recommendations (default 5, max 50)","schema":{"example":5,"type":"string"}}],"responses":{"200":{"description":"Recommended books","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BookResponseDto"}}}}},"400":{"description":"Invalid book ID (non-numeric or <= 0)","content":{"application/json":{"schema":{"example":{"statusCode":400,"message":"Invalid book ID","error":"Bad Request"}}}}},"404":{"description":"Book not found"}},"summary":"Recommend similar books by book ID","tags":["books"]}},"/recommendations/public":{"get":{"operationId":"RecommendationsController_publicList","parameters":[],"responses":{"200":{"description":""}},"summary":"Get active recommendation sections with items","tags":["recommendations"]}},"/recommendations/sections":{"get":{"operationId":"RecommendationsController_listSections","parameters":[{"name":"all","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"List sections","tags":["recommendations"]},"post":{"operationId":"RecommendationsController_createSection","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateSectionDto"}}}},"responses":{"201":{"description":""}},"security":[{"JWT-auth":[]}],"summary":"Create section","tags":["recommendations"],"x-permission":{"permission":"RECOMMENDATION_MANAGE","minLevel":1},"description":"Requires permission: RECOMMENDATION_MANAGE (level >= 1)"}},"/recommendations/sections/{id}":{"get":{"operationId":"RecommendationsController_getSection","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"number"}}],"responses":{"200":{"description":""}},"summary":"Get section detail","tags":["recommendations"]},"patch":{"operationId":"RecommendationsController_updateSection","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"number"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateSectionDto"}}}},"responses":{"200":{"description":""}},"security":[{"JWT-auth":[]}],"summary":"Update section","tags":["recommendations"],"x-permission":{"permission":"RECOMMENDATION_MANAGE","minLevel":1},"description":"Requires permission: RECOMMENDATION_MANAGE (level >= 1)"},"delete":{"operationId":"RecommendationsController_deleteSection","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"number"}}],"responses":{"200":{"description":""}},"security":[{"JWT-auth":[]}],"summary":"Delete section","tags":["recommendations"],"x-permission":{"permission":"RECOMMENDATION_MANAGE","minLevel":1},"description":"Requires permission: RECOMMENDATION_MANAGE (level >= 1)"}},"/recommendations/sections/{id}/items":{"post":{"operationId":"RecommendationsController_addItem","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"number"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddItemDto"}}}},"responses":{"201":{"description":""}},"security":[{"JWT-auth":[]}],"summary":"Add book to section","tags":["recommendations"],"x-permission":{"permission":"RECOMMENDATION_MANAGE","minLevel":1},"description":"Requires permission: RECOMMENDATION_MANAGE (level >= 1)"}},"/recommendations/sections/{sectionId}/items/{itemId}":{"delete":{"operationId":"RecommendationsController_removeItem","parameters":[{"name":"sectionId","required":true,"in":"path","schema":{"type":"number"}},{"name":"itemId","required":true,"in":"path","schema":{"type":"number"}}],"responses":{"200":{"description":""}},"security":[{"JWT-auth":[]}],"summary":"Remove item from section","tags":["recommendations"],"x-permission":{"permission":"RECOMMENDATION_MANAGE","minLevel":1},"description":"Requires permission: RECOMMENDATION_MANAGE (level >= 1)"}},"/recommendations/sections/{id}/items/reorder":{"patch":{"operationId":"RecommendationsController_reorderItems","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"number"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReorderItemsDto"}}}},"responses":{"200":{"description":""}},"security":[{"JWT-auth":[]}],"summary":"Reorder items inside section","tags":["recommendations"]}},"/permissions/grant":{"post":{"operationId":"PermissionsController_grant","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GrantPermissionDto"}}}},"responses":{"201":{"description":""}},"security":[{"JWT-auth":[]}],"tags":["permissions"],"x-permission":{"permission":"USER_UPDATE","minLevel":2},"description":"Requires permission: USER_UPDATE (level >= 2)"}},"/permissions/revoke":{"post":{"operationId":"PermissionsController_revoke","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevokePermissionDto"}}}},"responses":{"201":{"description":""}},"security":[{"JWT-auth":[]}],"tags":["permissions"],"x-permission":{"permission":"USER_UPDATE","minLevel":2},"description":"Requires permission: USER_UPDATE (level >= 2)"}},"/permissions/user/{id}":{"get":{"operationId":"PermissionsController_list","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"security":[{"JWT-auth":[]}],"tags":["permissions"],"x-permission":{"permission":"USER_READ","minLevel":1},"description":"Requires permission: USER_READ (level >= 1)"}}},"info":{"title":"Voidlord APIs","description":"The Voidlord API description\n\nPermissions:\n- USER_READ\n- USER_CREATE\n- USER_UPDATE\n- USER_DELETE\n- BOOK_READ\n- BOOK_CREATE\n- BOOK_UPDATE\n- BOOK_DELETE\n- RECOMMENDATION_MANAGE\nPermission Levels:\n- 0: 无权限 (no access)\n- 1: 基础使用 (basic)\n- 2: 授予/撤销其授予的 level 1\n- 3: 完全管理 (full)","version":"1.0","contact":{}},"tags":[],"servers":[],"components":{"securitySchemes":{"JWT-auth":{"scheme":"bearer","bearerFormat":"JWT","type":"http","name":"JWT","description":"Enter JWT token","in":"header"}},"schemas":{"CreateUserDto":{"type":"object","properties":{"username":{"type":"string","description":"Username for the user","example":"john_doe","minLength":1},"email":{"type":"string","description":"Email address of the user","example":"john@example.com","format":"email"},"password":{"type":"string","description":"Password for the user account","example":"SecurePassword123","minLength":6}},"required":["username","email","password"]},"UserResponseDto":{"type":"object","properties":{"id":{"type":"number","description":"User ID","example":1},"username":{"type":"string","description":"Username","example":"john_doe"},"email":{"type":"string","description":"Email address","example":"john@example.com"},"created_at":{"format":"date-time","type":"string","description":"Account creation date","example":"2023-01-01T00:00:00.000Z"},"updated_at":{"format":"date-time","type":"string","description":"Last update date","example":"2023-01-01T00:00:00.000Z"}},"required":["id","username","email","created_at","updated_at"]},"UpdateUserDto":{"type":"object","properties":{"username":{"type":"string","description":"Username for the user","example":"john_doe","minLength":1},"email":{"type":"string","description":"Email address of the user","example":"john@example.com","format":"email"},"password":{"type":"string","description":"Password for the user account","example":"SecurePassword123","minLength":6}}},"LoginResponseDto":{"type":"object","properties":{"access_token":{"type":"string","description":"JWT access token","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."},"user":{"description":"User information","allOf":[{"$ref":"#/components/schemas/UserResponseDto"}]}},"required":["access_token","user"]},"LoginUserDto":{"type":"object","properties":{"username":{"type":"string","description":"Username for login","example":"john_doe"},"password":{"type":"string","description":"Password for login","example":"SecurePassword123"}},"required":["username","password"]},"CreateTagDto":{"type":"object","properties":{"key":{"type":"string","description":"Tag key","example":"author"},"value":{"type":"string","description":"Tag value","example":"John Doe"},"shown":{"type":"boolean","description":"Whether the tag is shown","default":true}},"required":["key","value"]},"CreateBookDto":{"type":"object","properties":{"hash":{"type":"string","description":"Book hash","example":"abc123def456"},"title":{"type":"string","description":"Book title","example":"The Great Gatsby"},"description":{"type":"string","description":"Book description","example":"A classic novel"},"tags":{"description":"Tags associated with the book","type":"array","items":{"$ref":"#/components/schemas/CreateTagDto"}}},"required":["hash","title"]},"TagResponseDto":{"type":"object","properties":{"id":{"type":"number","description":"Tag ID"},"key":{"type":"string","description":"Tag key"},"value":{"type":"string","description":"Tag value"},"shown":{"type":"boolean","description":"Whether the tag is shown"},"created_at":{"format":"date-time","type":"string","description":"Tag creation date"},"updated_at":{"format":"date-time","type":"string","description":"Tag last update date"}},"required":["id","key","value","shown","created_at","updated_at"]},"BookResponseDto":{"type":"object","properties":{"id":{"type":"number","description":"Book ID"},"hash":{"type":"string","description":"Book hash"},"title":{"type":"string","description":"Book title"},"description":{"type":"string","description":"Book description"},"created_at":{"format":"date-time","type":"string","description":"Book creation date"},"updated_at":{"format":"date-time","type":"string","description":"Book last update date"},"tags":{"description":"Associated tags","type":"array","items":{"$ref":"#/components/schemas/TagResponseDto"}}},"required":["id","hash","title","created_at","updated_at","tags"]},"UpdateBookDto":{"type":"object","properties":{"hash":{"type":"string","description":"Book hash","example":"abc123def456"},"title":{"type":"string","description":"Book title","example":"The Great Gatsby"},"description":{"type":"string","description":"Book description","example":"A classic novel"},"tags":{"description":"Tags associated with the book","type":"array","items":{"$ref":"#/components/schemas/CreateTagDto"}}}},"CreateSectionDto":{"type":"object","properties":{"key":{"type":"string","description":"Unique key, lowercase letters, numbers, underscore","example":"today_hot"},"title":{"type":"string","description":"Display title","example":"今日最热"},"description":{"type":"string"},"sort_order":{"type":"number","default":0},"active":{"type":"boolean","default":true}},"required":["key","title"]},"UpdateSectionDto":{"type":"object","properties":{"key":{"type":"string","description":"Unique key, lowercase letters, numbers, underscore"},"title":{"type":"string","description":"Display title"},"description":{"type":"string"},"sort_order":{"type":"number"},"active":{"type":"boolean"},"sectionOrder":{"description":"Optional reorder of section ids (for batch sorting)","type":"array","items":{"type":"number"}}}},"AddItemDto":{"type":"object","properties":{"bookId":{"type":"number","description":"Book ID to add"},"position":{"type":"number","description":"Desired position (if omitted append to end)"},"note":{"type":"string","description":"Optional note shown with the book"}},"required":["bookId"]},"ReorderItemsDto":{"type":"object","properties":{"itemIds":{"description":"Array of item IDs in new order","type":"array","items":{"type":"string"}}},"required":["itemIds"]},"GrantPermissionDto":{"type":"object","properties":{"userId":{"type":"number","description":"目标用户ID (被授予者)","example":12,"minimum":1},"permission":{"type":"string","description":"权限名称","enum":["USER_READ","USER_CREATE","USER_UPDATE","USER_DELETE","BOOK_READ","BOOK_CREATE","BOOK_UPDATE","BOOK_DELETE","RECOMMENDATION_MANAGE"],"example":"USER_READ"},"level":{"type":"number","description":"授予等级 (1=基础 2=可授予/撤销其授予的level1 3=完全)","example":1,"minimum":1,"maximum":3}},"required":["userId","permission","level"]},"RevokePermissionDto":{"type":"object","properties":{"userId":{"type":"number","description":"目标用户ID (被撤销者)","example":12,"minimum":1},"permission":{"type":"string","description":"权限名称","enum":["USER_READ","USER_CREATE","USER_UPDATE","USER_DELETE","BOOK_READ","BOOK_CREATE","BOOK_UPDATE","BOOK_DELETE","RECOMMENDATION_MANAGE"],"example":"USER_READ"}},"required":["userId","permission"]}}}}